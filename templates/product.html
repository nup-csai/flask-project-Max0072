{% extends 'sidebar.html' %}
{% block content %}
    <h2 class="text-center mb-4">The Biggest Online Store of Firewood</h2>

    <div class="container">
        <!-- –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –≤—ã–≤–æ–¥–∏–º –∏—Ö –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image" style="background-image: url({{ url_for('uploaded_file', filename=product.filename)}});"></div>
                <h2>{{ product.name }}</h2>
                <button id="learn_more" class="openModalBtn" data-id="{{ product.id }}">Learn more</button>
            </div>
            {% endfor %}
        </div>
    </div>

    {% for product in products %}
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="myModal{{ product.id }}" class="modal">

        <div class="modal-content">
            <span class="close-btn" data-id="{{ product.id }}">&times;</span>
            <div class="product-image" style="background-image: url('pictures/{{ product.filename }}');"></div>
            <h2>{{ product.name }}</h2>
            <p>{{ product.description }}</p>
            <h3 id="product-price">‚Ç¨{{ product.price }}/m¬≥</h3>
            <form action="{{ url_for('add_to_cart', link_token=link_token, product_id=product.id) }}" method="POST">
                <div class="quantity-controls">
                    <input name="quantity" type="number" value="1" class="quantity-input" data-id="1" min="1">
                </div>
                <button class="openBuyButton" data-id="{{ product.id }}">Add to cart</button>
            </form>

        </div>
    </div>
    {% endfor %}




<!-- –°–∞–π–¥–±–∞—Ä2 -->
<div id="sidebar2">
    <h2 class="cart-label">Cart</h2>

    {% for product in cart %}
        <div class="cart-item">
            <img src="{{ url_for('uploaded_file', filename=product.filename) }}" alt="Product Image" class="cart-image">
            <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <span class="product-price">‚Ç¨{{ product.price }}</span>
                <div class="quantity-control">
                    <span class="product-quantity">Quantity: {{ product.quantity }}</span>
                </div>
                <span class="total-price">‚Ç¨{{ "{:.2f}".format(product.price * product.quantity) }}</span>
            </div>
            <form action="{{ url_for('delete_from_cart', id=product.product_id, link_token=link_token) }}" method="POST">
                <button>‚å´</button>
            </form>
        </div>
    {% endfor %}

    <div class="cart-summary">
        <p>Total: <span id="total-amount">‚Ç¨{{ sum }}</span></p>
        <form action="{{ url_for('checkout', link_token=link_token) }}">
            <button id="checkout-btn">Checkout</button>
        </form>
    </div>
</div>


    <div class="cart-button" id="cartButton">
        üõí
    </div>

    <script>

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –æ–∫–æ–Ω
        document.addEventListener('DOMContentLoaded', function () {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const openModalBtns = document.querySelectorAll('.openModalBtn');
            const closeModalBtns = document.querySelectorAll('.close-btn');

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            openModalBtns.forEach(function (button) {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    const modal = document.getElementById(`myModal${productId}`);
                    modal.style.display = 'block';
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            closeModalBtns.forEach(function (button) {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    const modal = document.getElementById(`myModal${productId}`);
                    modal.style.display = 'none';
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –æ–∫–Ω–∞
            window.addEventListener('click', function (event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(function (modal) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            const sidebar = document.getElementById('sidebar2');
            const mainContent = document.getElementById('main-content');
            const toggleButton = document.getElementById('toggle-sidebar');
            const overlay = document.getElementById('overlay')

            // –£—Å—Ç–∞–Ω–æ–≤–∏–º –æ–±–ª–∞—Å—Ç—å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —Å–∞–π–¥–±–∞—Ä –±—É–¥–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30px –æ—Ç –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è)
            const triggerAreaWidth = 50;
            const removeAreaWidth = 350;
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä, –∫–æ–≥–¥–∞ –∫—É—Ä—Å–æ—Ä –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –ª–µ–≤–æ–º—É –∫—Ä–∞—é —ç–∫—Ä–∞–Ω–∞
            window.addEventListener('mousemove', function(event) {
                if (event.clientX < triggerAreaWidth) {
                    sidebar.classList.add('show');
                    mainContent.classList.add('shifted');
                    overlay.classList.add('appear_left')
                } else if (event.clientX > removeAreaWidth){
                    sidebar.classList.remove('show');
                    mainContent.classList.remove('shifted');
                    overlay.classList.remove('appear_left')
                }
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
            toggleButton.addEventListener('click', function() {
                sidebar.classList.toggle('show');
                mainContent.classList.toggle('shifted');
                {#overlay.classList.toggle('appear_left')#}
            });

            // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ—Ä–∑–∏–Ω–µ
            const cart = [
                { id: 1, name: 'Product Name', price: 19.99, quantity: 1 },
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
            ];

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—â–µ–π —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
            function updateTotal() {
                let total = 0;
                cart.forEach(item => {
                    total += item.price * item.quantity;
                });
                document.getElementById('total-amount').textContent = total.toFixed(2);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
            document.querySelectorAll('.increase-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    const product = cart.find(item => item.id == productId);
                    product.quantity += 1;

                    const quantityInput = document.querySelector(`.quantity-input[data-id="${productId}"]`);
                    quantityInput.value = product.quantity;

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                    const itemTotal = document.querySelector(`.item-total[data-id="${productId}"]`);
                    itemTotal.textContent = `$${(product.price * product.quantity).toFixed(2)}`;

                    updateTotal(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É
                });
             });

            document.querySelectorAll('.decrease-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    const product = cart.find(item => item.id == productId);

                    if (product.quantity > 1) {
                        product.quantity -= 1;
                        const quantityInput = document.querySelector(`.quantity-input[data-id="${productId}"]`);
                        quantityInput.value = product.quantity;

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                        const itemTotal = document.querySelector(`.item-total[data-id="${productId}"]`);
                        itemTotal.textContent = `$${(product.price * product.quantity).toFixed(2)}`;

                        updateTotal(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É
                    }
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ä—É—á–Ω—É—é –≤ input
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('input', function () {
                    const productId = this.getAttribute('data-id');
                    const product = cart.find(item => item.id == productId);
                    const newQuantity = parseInt(this.value, 10);

                    if (newQuantity > 0) {
                        product.quantity = newQuantity;
                        const itemTotal = document.querySelector(`.item-total[data-id="${productId}"]`);
                        itemTotal.textContent = `$${(product.price * product.quantity).toFixed(2)}`;

                        updateTotal(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É
                    } else {
                        this.value = product.quantity; // –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω—å—à–µ 1, –Ω–µ –º–µ–Ω—è–µ–º
                    }
                });
            });

            // –ö–Ω–æ–ø–∫–∞ "Checkout" (–≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)
            document.getElementById('checkout-btn').addEventListener('click', function () {
                alert('Proceeding to checkout...');
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω—ã (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
            cart.forEach(item => {
                document.querySelector(`.quantity-input[data-id="${item.id}"]`).value = item.quantity;
                document.querySelector(`.item-total[data-id="${item.id}"]`).textContent = `$${(item.price * item.quantity).toFixed(2)}`;
            });
        });

    </script>
{% endblock %}
